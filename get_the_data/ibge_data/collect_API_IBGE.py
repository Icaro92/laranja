# %%
import requests
import json
import pprint
import datetime
import os
# %%
# Cód 109 = Área plantada
# Cód 216 = Área colhida
# Cód 35 = Produção
# Cód 36 = Rendimento médio
# %%
url_producao = 'https://servicodados.ibge.gov.br/api/v3/agregados/6588/periodos/200701|200702|200703|200704|200705|200706|200707|200708|200709|200710|200711|200712|200801|200802|200803|200804|200805|200806|200807|200808|200809|200810|200811|200812|200901|200902|200903|200904|200905|200906|200907|200908|200909|200910|200911|200912|201001|201002|201003|201004|201005|201006|201007|201008|201009|201010|201011|201012|201101|201102|201103|201104|201105|201106|201107|201108|201109|201110|201111|201112|201201|201202|201203|201204|201205|201206|201207|201208|201209|201210|201211|201212|201301|201302|201303|201304|201305|201306|201307|201308|201309|201310|201311|201312|201401|201402|201403|201404|201405|201406|201407|201408|201409|201410|201411|201412|201501|201502|201503|201504|201505|201506|201507|201508|201509|201510|201511|201512|201601|201602|201603|201604|201605|201606|201607|201608|201609|201610|201611|201612|201701|201702|201703|201704|201705|201706|201707|201708|201709|201710|201711|201712|201801|201802|201803|201804|201805|201806|201807|201808|201809|201810|201811|201812|201901|201902|201903|201904|201905|201906|201907|201908|201909|201910|201911|201912|202001|202002|202003|202004|202005|202006|202007|202008|202009|202010|202011|202012|202101|202102|202103|202104|202105|202106|202107|202108|202109|202110|202111|202112|202201|202202|202203|202204|202205|202206|202207|202208|202209|202210|202211|202212|202301|202302|202303|202304|202305|202306|202307|202308|202309|202310|202311|202312|202401|202402/variaveis/35?localidades=N3[all]&classificacao=48[39463]'
url_rendimento_medio = 'https://servicodados.ibge.gov.br/api/v3/agregados/6588/periodos/200701|200702|200703|200704|200705|200706|200707|200708|200709|200710|200711|200712|200801|200802|200803|200804|200805|200806|200807|200808|200809|200810|200811|200812|200901|200902|200903|200904|200905|200906|200907|200908|200909|200910|200911|200912|201001|201002|201003|201004|201005|201006|201007|201008|201009|201010|201011|201012|201101|201102|201103|201104|201105|201106|201107|201108|201109|201110|201111|201112|201201|201202|201203|201204|201205|201206|201207|201208|201209|201210|201211|201212|201301|201302|201303|201304|201305|201306|201307|201308|201309|201310|201311|201312|201401|201402|201403|201404|201405|201406|201407|201408|201409|201410|201411|201412|201501|201502|201503|201504|201505|201506|201507|201508|201509|201510|201511|201512|201601|201602|201603|201604|201605|201606|201607|201608|201609|201610|201611|201612|201701|201702|201703|201704|201705|201706|201707|201708|201709|201710|201711|201712|201801|201802|201803|201804|201805|201806|201807|201808|201809|201810|201811|201812|201901|201902|201903|201904|201905|201906|201907|201908|201909|201910|201911|201912|202001|202002|202003|202004|202005|202006|202007|202008|202009|202010|202011|202012|202101|202102|202103|202104|202105|202106|202107|202108|202109|202110|202111|202112|202201|202202|202203|202204|202205|202206|202207|202208|202209|202210|202211|202212|202301|202302|202303|202304|202305|202306|202307|202308|202309|202310|202311|202312|202401|202402/variaveis/36?localidades=N3[all]&classificacao=48[39463]'
url_area_plantada = 'https://servicodados.ibge.gov.br/api/v3/agregados/6588/periodos/200701|200702|200703|200704|200705|200706|200707|200708|200709|200710|200711|200712|200801|200802|200803|200804|200805|200806|200807|200808|200809|200810|200811|200812|200901|200902|200903|200904|200905|200906|200907|200908|200909|200910|200911|200912|201001|201002|201003|201004|201005|201006|201007|201008|201009|201010|201011|201012|201101|201102|201103|201104|201105|201106|201107|201108|201109|201110|201111|201112|201201|201202|201203|201204|201205|201206|201207|201208|201209|201210|201211|201212|201301|201302|201303|201304|201305|201306|201307|201308|201309|201310|201311|201312|201401|201402|201403|201404|201405|201406|201407|201408|201409|201410|201411|201412|201501|201502|201503|201504|201505|201506|201507|201508|201509|201510|201511|201512|201601|201602|201603|201604|201605|201606|201607|201608|201609|201610|201611|201612|201701|201702|201703|201704|201705|201706|201707|201708|201709|201710|201711|201712|201801|201802|201803|201804|201805|201806|201807|201808|201809|201810|201811|201812|201901|201902|201903|201904|201905|201906|201907|201908|201909|201910|201911|201912|202001|202002|202003|202004|202005|202006|202007|202008|202009|202010|202011|202012|202101|202102|202103|202104|202105|202106|202107|202108|202109|202110|202111|202112|202201|202202|202203|202204|202205|202206|202207|202208|202209|202210|202211|202212|202301|202302|202303|202304|202305|202306|202307|202308|202309|202310|202311|202312|202401|202402/variaveis/109?localidades=N3[all]&classificacao=48[39463]'
url_area_colhida = 'https://servicodados.ibge.gov.br/api/v3/agregados/6588/periodos/200701|200702|200703|200704|200705|200706|200707|200708|200709|200710|200711|200712|200801|200802|200803|200804|200805|200806|200807|200808|200809|200810|200811|200812|200901|200902|200903|200904|200905|200906|200907|200908|200909|200910|200911|200912|201001|201002|201003|201004|201005|201006|201007|201008|201009|201010|201011|201012|201101|201102|201103|201104|201105|201106|201107|201108|201109|201110|201111|201112|201201|201202|201203|201204|201205|201206|201207|201208|201209|201210|201211|201212|201301|201302|201303|201304|201305|201306|201307|201308|201309|201310|201311|201312|201401|201402|201403|201404|201405|201406|201407|201408|201409|201410|201411|201412|201501|201502|201503|201504|201505|201506|201507|201508|201509|201510|201511|201512|201601|201602|201603|201604|201605|201606|201607|201608|201609|201610|201611|201612|201701|201702|201703|201704|201705|201706|201707|201708|201709|201710|201711|201712|201801|201802|201803|201804|201805|201806|201807|201808|201809|201810|201811|201812|201901|201902|201903|201904|201905|201906|201907|201908|201909|201910|201911|201912|202001|202002|202003|202004|202005|202006|202007|202008|202009|202010|202011|202012|202101|202102|202103|202104|202105|202106|202107|202108|202109|202110|202111|202112|202201|202202|202203|202204|202205|202206|202207|202208|202209|202210|202211|202212|202301|202302|202303|202304|202305|202306|202307|202308|202309|202310|202311|202312|202401|202402/variaveis/216?localidades=N3[all]&classificacao=48[39463]'

url_tudo = 'https://servicodados.ibge.gov.br/api/v3/agregados/6588/periodos/200701|200702|200703|200704|200705|200706|200707|200708|200709|200710|200711|200712|200801|200802|200803|200804|200805|200806|200807|200808|200809|200810|200811|200812|200901|200902|200903|200904|200905|200906|200907|200908|200909|200910|200911|200912|201001|201002|201003|201004|201005|201006|201007|201008|201009|201010|201011|201012|201101|201102|201103|201104|201105|201106|201107|201108|201109|201110|201111|201112|201201|201202|201203|201204|201205|201206|201207|201208|201209|201210|201211|201212|201301|201302|201303|201304|201305|201306|201307|201308|201309|201310|201311|201312|201401|201402|201403|201404|201405|201406|201407|201408|201409|201410|201411|201412|201501|201502|201503|201504|201505|201506|201507|201508|201509|201510|201511|201512|201601|201602|201603|201604|201605|201606|201607|201608|201609|201610|201611|201612|201701|201702|201703|201704|201705|201706|201707|201708|201709|201710|201711|201712|201801|201802|201803|201804|201805|201806|201807|201808|201809|201810|201811|201812|201901|201902|201903|201904|201905|201906|201907|201908|201909|201910|201911|201912|202001|202002|202003|202004|202005|202006|202007|202008|202009|202010|202011|202012|202101|202102|202103|202104|202105|202106|202107|202108|202109|202110|202111|202112|202201|202202|202203|202204|202205|202206|202207|202208|202209|202210|202211|202212|202301|202302|202303|202304|202305|202306|202307|202308|202309|202310|202311|202312|202401|202402/variaveis/109|216|35|36?localidades=N1[all]&classificacao=48[39463]'

urls = [url_producao, url_area_plantada, url_rendimento_medio, url_area_colhida]

# %%

# VERSÃO 1.0 - NÃO USAR


def get_data_ibge(url):
    resp = requests.get(url)
    if resp.status_code == 200:
        data = resp.json()
        #result = data[0]['resultados'][0]['series'][0]
        result = data[0]['resultados'][0]['series'][0:26]
        return result
    else:
        print('Erro! Status code: {}'.format(resp.status_code))
        return None
    #def save_data(data):
    now = datetime.datetime.now().strftime("%Y-%m-%d %H_%M_%S.%f")
    for url in urls:
        url_name = url.split('/')[-1].split('=')[0].split('_')[-1].split('?')[0]
        data = get_data_ibge(url)
        with open(f'get_the_data/ibge_data/{now}_{url_name}.json', 'w') as open_file:
            json.dump(data, open_file, indent=4)

def save_data(urls):
    now = datetime.datetime.now().strftime("%Y-%m-%d %H_%M_%S.%f")
    for url in urls:
        url_name = url.split('/')[-1].split('=')[0].split('_')[-1].split('?')[0]
        data = get_data_ibge(url)
        directory = 'get_the_data/ibge_data/'
        if not os.path.exists(directory):
            os.makedirs(directory)
        with open(f'{directory}{now}_{url_name}.json', 'w') as open_file:
            json.dump(data, open_file, indent=4)            


# %%
save_data(urls)

# %%
# VERSÃO 2.0 = UTILIZAR ESSA - Contem dados por estado

def get_data_ibge2(url):
    resp = requests.get(url)
    if resp.status_code == 200:
        data = resp.json()
        results =[]
        #result = data[0]['resultados'][0]['series'][0]
        for i in range(26):
            series_name= data[0]['resultados'][0]['series'][i]['localidade']['nome']
            result = {
                'localidade_nome': series_name,
                'data':data[0]['resultados'][0]['series'][i]['serie']
            }
            results.append(result)
        return results
            #result = data[series_name] = data[0]['resultados'][0]['series'][i]
            #return result
    else:
        print('Erro! Status code: {}'.format(resp.status_code))
        return None  
   
   
def save_data2(urls):
    now = datetime.datetime.now().strftime("%Y-%m-%d %H_%M_%S.%f")
    for url in urls:
        url_name = url.split('/')[-1].split('=')[0].split('_')[-1].split('?')[0]
        data = get_data_ibge2(url)
        directory = 'get_the_data/ibge_data/'
        if not os.path.exists(directory):
            os.makedirs(directory)
        with open(f'{directory}{now}_{url_name}.json', 'w') as open_file:
            json.dump(data, open_file, indent=4) 

# %%
save_data2(urls)


# %%
#pprint.pprint(data[0]['unidade'])
# PARA TESE
#resp = requests.get(url_producao)
#resp.status_code
#data = resp.json()

# %%
#pprint.pprint(data[0]['resultados'][0]['series'][0]) #unidades - Toneladas - Variável: Produção
#pprint.pprint(data[0]['resultados'][0]['series'][0]['localidade']['nome'])
    
# %%
#print(data)

#item_busca = data[0]['unidade'] #variável   
#safras_mes = data[0]['resultados'][0]['series'][0] #serie 
# %%
